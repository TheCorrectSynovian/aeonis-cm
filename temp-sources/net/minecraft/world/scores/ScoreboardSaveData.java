package net.minecraft.world.scores;

import com.mojang.serialization.Codec;
import com.mojang.serialization.codecs.RecordCodecBuilder;
import java.util.List;
import java.util.Map;
import net.minecraft.util.datafix.DataFixTypes;
import net.minecraft.world.level.saveddata.SavedData;
import net.minecraft.world.level.saveddata.SavedDataType;

public class ScoreboardSaveData extends SavedData {
	public static final SavedDataType<ScoreboardSaveData> TYPE = new SavedDataType<>(
		"scoreboard",
		ScoreboardSaveData::new,
		ScoreboardSaveData.Packed.CODEC.xmap(ScoreboardSaveData::new, ScoreboardSaveData::getData),
		DataFixTypes.SAVED_DATA_SCOREBOARD
	);
	private ScoreboardSaveData.Packed data;

	private ScoreboardSaveData() {
		this(ScoreboardSaveData.Packed.EMPTY);
	}

	public ScoreboardSaveData(ScoreboardSaveData.Packed packed) {
		this.data = packed;
	}

	public ScoreboardSaveData.Packed getData() {
		return this.data;
	}

	public void setData(ScoreboardSaveData.Packed packed) {
		if (!packed.equals(this.data)) {
			this.data = packed;
			this.setDirty();
		}
	}

	public record Packed(
		List<Objective.Packed> objectives, List<Scoreboard.PackedScore> scores, Map<DisplaySlot, String> displaySlots, List<PlayerTeam.Packed> teams
	) {
		public static final ScoreboardSaveData.Packed EMPTY = new ScoreboardSaveData.Packed(List.of(), List.of(), Map.of(), List.of());
		public static final Codec<ScoreboardSaveData.Packed> CODEC = RecordCodecBuilder.create(
			instance -> instance.group(
					Objective.Packed.CODEC.listOf().optionalFieldOf("Objectives", List.of()).forGetter(ScoreboardSaveData.Packed::objectives),
					Scoreboard.PackedScore.CODEC.listOf().optionalFieldOf("PlayerScores", List.of()).forGetter(ScoreboardSaveData.Packed::scores),
					Codec.unboundedMap(DisplaySlot.CODEC, Codec.STRING).optionalFieldOf("DisplaySlots", Map.of()).forGetter(ScoreboardSaveData.Packed::displaySlots),
					PlayerTeam.Packed.CODEC.listOf().optionalFieldOf("Teams", List.of()).forGetter(ScoreboardSaveData.Packed::teams)
				)
				.apply(instance, ScoreboardSaveData.Packed::new)
		);
	}
}
